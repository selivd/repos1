
\section{Общая теоретическая часть}

Для поиска множества $\mathcal{X}[t,t_0]$ будем использовать функцию цены
$$
%%\label{eq:value_f}
V(t,x)=\min_{u(\cdot)}\max_{v(\cdot)}d^2(x_0,\mathcal{X}_0)\mid_{x(t)=x}
$$

где $d(x_0,\mathcal{X}_0)$ - расстояние между точкой $x_0$ и множеством $\mathcal{X}_0$, определяемое метрикой
$d(x,\mathcal{X})=\min_{y\in\mathcal{X}} \|x-y\|$.
Такой выбор вызван следующими причинами. Мы ищем множество $\mathcal{X}[t,\mathcal{X}_0]$ всех таких точек, что  для $\forall x^*(t)\in\mathcal{X}[t,\mathcal{X}_0]$ можно заранее подобрать некоторое управление $u^*(\cdot)$ и некоторое подмножество $\{x^*(t_0)\}\in\mathcal{X}_0$ так, чтобы при любой помехе $v(\cdot)$ гарантировать вхождение $x^*(t)\in \{x(t,u^*(\cdot),\{x^*(t_0)\})\}_{\forall v(\cdot)}$. В рассматриваемой здесь задаче кроме помехи $v(\cdot)$ появляется другой неизвестный параметр $\tau(u,v)$ -- момент переключения, в который меняется динамика системы, что приводит к существенному усложениню задачи.


Пусть $\phi(x)=d^2(x_0,\mathcal{X}_0)$. Так как $\mathcal{X}_0$ -- по условию задачи выпуклое множество, то операция двойного сопряжения приводит к тождественному результату. Поэтому удобно выразить $V(x,t)$ через двойное сопряжение функции расстояния $d^2(x,\mathcal{X}_0)$. 

$$
\phi^{*}(\ell)=\sup_{x}( \ts{x,\ell} -  d^2(x,\mathcal{X}_0)) = \rho(\ell\mid\mathcal{X}_0)+\frac{\|\ell\|^2}{4},
$$

тогда

\begin{equation}
\label{eq:valued2}
V(t,x)=\min_{u(\cdot)}\max_{v(\cdot)}\sup_{\ell}\left(\ts{\ell,x_0} - \rho(\ell\mid\mathcal{X}_0)-\frac{\|\ell\|^2}{4}\right).
\end{equation}

%
%
%Выпишем теперь решение $x(t,t_0,x_0)$  для первой системы из \eqref{eq:primer_sys}
%$$
%\begin{aligned}
%x^{(1)}_2(t,t_0)&=x^{(1)}_{02}+\int\limits_{t_0^{(1)}}^{t}u^{(1)}(s)\,ds;\\
%x^{(1)}_1(t,t_0)&=x^{(1)}_{01}+\int\limits_{t_0^{(1)}}^{t}\left( \int\limits_{t_0^{(1)}}^{\tau}u^{(1)}(s)\,ds + x^{(1)}_{02} \right)\,d\tau + \int\limits_{t_0^{(1)}}^{t} v^{(1)}(s)\, ds;\\
%\end{aligned}
%$$
%
%Решение для второй системы
%$$
%x^{(2)}(t,t^{(2)}_0)=G(t,t^{(2)}_0)x^{(2)}_0 + \int\limits_{\tau}^t G(t,s)\left(Bu(s)+Cv(s)\right)\,ds,
%$$
%где $G(t,s)=e^{A(t-s)},\,B={\begin{pmatrix} 0 \\ 1\end{pmatrix}},\,C={\begin{pmatrix} 1 \\ 0\end{pmatrix}},A={
%\begin{pmatrix}
%0 & 1\\
%-\gamma & -\mu
%\end{pmatrix}} $

Найдем выражения для поиска $x_0\mid_{x(t_1)=x}$.
Пусть траектория точки в момент $t_1$ известна $x(t_1)=x$.
Идя в обратном времени, найдем её значение в момент $\tau\leqslant t\leqslant t_1$ при известных $B(s),C(s),u(s),v(s)$ до переключения:
$$
x^{(2)}(t,x,u,v)=G_2(t,t_1)x+\int\limits_{t_1}^t G_2(t,s)\left[B_2(s)u_2(s)+C_2(s)v_2(s)\right]ds,\mbox{при}\, \tau\leqslant t \leqslant t_1,
$$
 и после для $t_0\leqslant t\leqslant \tau$:
\begin{equation}
\label{eq:solvex0}
\begin{aligned}
x^{(2,1)}(t,\tau,x,u,v)=&G_1(t,\tau)G_2(\tau,t_1)x+G_1(t,\tau)\int\limits_{t_1}^\tau G_2(t,s)\left[B_2(s)u_2(s)+C_2(s)v_2(s)\right]ds +\\ 
&+\int\limits_{\tau}^{t_0} G_1(t,s)\left[B_1(s)u_1(s)+C_1(s)v_1(s)\right]ds\,,\;\mbox{при}\, t_0 \leqslant t \leqslant \tau.
\end{aligned}
\end{equation}

Нам необходимо, чтобы момент $\tau$ в этих выражениях удовлетворял условию на переключение, так чтобы $\ts{x(\tau),c}=\gamma$.
Поскольку $d^2(x,\mathcal{X})\geqslant 0$, то $V(x,t)\geqslant 0$. Тогда если $\mathcal{X}[t,t_0]=\{x\mid V(t,x)\leqslant 0\}, \forall t\in[t_0,t_1]$, то достаточно ввести штрафующий член $ \left(\ts{x(\tau),c}-\gamma\right)^2$ в выражение для $V(t,x)$, тем самым обеспечивая  для $\mathcal{X}[t,t_0]$ включение только тех траекторий, которые удовлетворяют нашим двум системам и условию на момент переключения. 

Так как мы рассматриваем задачу в классе программных управлений, мы не можем строить управление в зависимости от текущего состояния системы, а должны определять его заранее. Поэтому, в формуле для $V(t,x)$ нельзя искать отдельно $\min_{u^{(i)}}\max_{v^{(i)}}$ для каждой из подсистем  ''до'' и ''после'', так как момент переключения $\tau$ не известен заранее. Это означает, что выбираемое управление не может меняться в зависимости от $\tau$. Поскольку в общем случае ограничения на управления для разных подсистем различны, то выбираемое заранее управление должно удовлетворять обоим ограничениям $[ u^*(\cdot)\in\mathcal{P}^{(1)}]\wedge[u^*(\cdot)\in\mathcal{P}^{(2)}] $. 
Поэтому справедливо положить $u(t)\in\mathcal{P}[\mathcal{T}]=\min\{\mathcal{P}^{(1)}[\mathcal{T}],\mathcal{P}^{(2)}[\mathcal{T}]\}$ для множества $\mathcal{T}$ такого, что $\mathcal{T}=\cup_{v,u} \tau(v,u)\subseteq [t_0,t]$. Мы будем рассматривать задачу для  $\mathcal{P}[t_0,t]=\mathcal{P}^{(1)}[t_0,t]=\mathcal{P}^{(2)}[t_0,t]$.

$$
V(t,x)=\min_{u_1,u_2\in\mathcal{P}}\max_{v_1,v_2\in\mathcal{W}}\min_{\tau}\left\{ d^2(x_0{\mid_{x(t)=x}},\mathcal{X}_0) + \left(\ts{x(\tau),c}-\gamma\right)^2 \right\}.
%V(t,x)=\min_{u_1\in \mathcal{P}_1}\max_{v_1\in\mathcal{W}_1}\left\{ 
$$
Это значит, что искомое множество $\mathcal{X}[t,\mathcal{X}_0]$ в классе программных управлений содержит только те траектории, которые при любой допустимой помехе $v_1(\cdot),v_2(\cdot)$ и при любом $\tau(v,\cdot)$ гарантированно могут попасть на множество $\mathcal{X}[t,\mathcal{X}_0]$
Пока примем $\gamma=0$. Для линеаризации условия на переключение сделаем подстановку
$$
\ts{x,c}^2\equiv\max_\mu \left\{\mu \ts{x,c} - \frac{\mu^2}{4}\right\},
$$
и, используя \eqref{eq:valued2}, имеем
$$
V(t,x)=\min_{u_1,u_2 \in\mathcal{P}}\max_{v_1,v_2\in\mathcal{W}}\min_{\tau}\left\{
\max_{\ell}\max_{\mu} \left\{\ts{\ell,x_0\mid_{x(t)=x}} +\mu\ts{x(\tau),c}-\frac{\mu^2}{4}- \rho(\ell\mid\mathcal{X}_0)-\frac{\|\ell\|^2}{4}
\right\}\right\}.
$$

Раскрывая \eqref{eq:solvex0}, получим

$$
\begin{gathered}
 V(t,x)=\min_{u_1,u_2}\max_{v_1,v_2}\min_{\tau\in[t_0,t]} \max_{\ell}\max_{\mu} \{  \\
 \ts{\ell,G_1(t_0,\tau)G_2(\tau,t)x} + \int\limits_t^\tau \ts{\ell,G_1(t_0,\tau)G_2(\tau,s)\left[B_2(s)u_2(s)+C_2(s)v_2(s)\right]}\,ds+ \\ 
 + \int\limits_\tau^{t_0} \ts{\ell,G_1(t_0,s)\left[B_1(s)u_1(s)+C_1(s)v_1(s)\right]}\,ds + \mu\ts{c,G_2(\tau,t)x}+ \\
 + \mu\int\limits_t^\tau \ts{c,G_2(\tau,s)\left[B_2(s)u_2(s)+C_2(s)v_2(s)\right]}\,ds-\\
 - \frac{\mu^2}{4} - \rho(\ell\mid\mathcal{X}_0)-\frac{\|\ell\|^2}{4}  \}
\end{gathered}
$$
Сгруппируем слагаемые 
$$
\begin{aligned}
\tilde{S}(\tau,t)&= G_2^T(\tau,t)G_1^T(t_0,\tau)\ell + \mu G_2^T(\tau,t) c ,\\
\tilde{S}_1(t_0,\tau)&=G_1^T(t_0,\tau)\ell ,
\end{aligned}
$$
имеем
\begin{equation}
\label{eq:big_valuef}
\begin{gathered}
 V(t,x)=\min_{u_1,u_2}\max_{v_1,v_2}\min_{\tau\in[t_0,t]} \max_{\ell}\max_{\mu} \{  \\
  \tilde{S}^T(\tau,t)x + \int\limits_t^\tau \tilde{S}^T(\tau,s)\left[B_2(s)u_2(s)+C_2(s)v_2(s)\right]\,ds+ \\ 
 + \int\limits_\tau^{t_0} \tilde{S}^T_1(t_0,s)\left[B_1(s)u_1(s)+C_1(s)v_1(s)\right]\,ds - \\
 - \frac{\mu^2}{4} - \rho(\ell\mid\mathcal{X}_0)-\frac{\|\ell\|^2}{4}  \}
\end{gathered}
\end{equation}

Чтобы эффективно вычислять множества достижимости используется прием, который позволяет заменить поиск множества допустимых траекторий вычислением опорной функции к этому множетсву. Для перехода к опорным функциям требуется менять местами порядок минимумов и максимумов в \eqref{eq:big_valuef}, а для этого необходимо выполнение условий теоремы минимакса. Поэтому дальнейшие преобразования выполняются с целью обеспечения этих условий. Одним из достаточных условий перестановки является линейность по минимизирующему или максимизирующему параметру. Наша цель состоим в том, чтобы перенести операции минимума по $u_1,u_2$ и максимума по $v_1,v_2$ внутрь выражения функции цены, тем самым сводя минимизацию/максимизацию на функциональном пространстве $\mathcal{P},\mathcal{W}$  к поиску экстремумов для выпуклых(вогнутых) функций. Первыми меняются местами $\max_{v_1,v_2}\min_\tau(\cdot)=\min_\tau\max_{v_1,v_2}(\cdot)$. Для примера, сначала рассмотрим функционал
$$
T(\tau,v(s))=\int\limits_t^{\tau}v(s)ds 
$$
Легко видеть, что $T(\tau,v(s))$, являясь линейным по $v$, не является таковым по $\tau$. Тогда вместо $\tau$ возьмем функцию ограниченной вариации $\tau(w)=\phi(w)$  и преобразуем 
$$
T(\phi(w),v(s))=\int\limits_{t_0}^t d\phi(w) \int\limits_t^{w}v(s)ds.
$$

Мы заменили множество $\tau$ более широким множеством функций $\phi(w)$. Условием нормировки для этих функций служит следующее выражение
$$
\intd{t_0}{t}d\phi(w)=1.
$$

Теперь функционал $T(\phi,v)$ является линейным по всем аргументам. 

Аналогично поступим с $V(t,x)$:
$$
\begin{gathered}
 V(t,x)=\min_{u_1,u_2}\max_{v_1,v_2}\min_{\phi(w)} \max_{\ell(w)}\max_{\mu(w)}\intd{t_0}{t} d\phi(w)\bigg\{  \\
  \tilde{S}^T(w,t)x + \intd{t}{w} \tilde{S}^T(w,s)\left[B_2(s)u_2(s)+C_2(s)v_2(s)\right]\,ds+  \\
 + \intd{w}{t_0} \tilde{S}^T_1(t_0,s)\left[B_1(s)u_1(s)+C_1(s)v_1(s)\right]\,ds - \\
 - \frac{\mu^2}{4} - \rho(\ell\mid\mathcal{X}_0)-\frac{\|\ell\|^2}{4}  \bigg\},
\end{gathered}
$$
Поскольку мы здесь воспользовались перестановкой 
$$\int\max_{\ell,\mu} f(w,\ell,\mu) d\phi(w) = \max_{\ell(w),\mu(w)}\int f(w,\ell(w),\mu(w))d\phi(w)$$
$\ell,\mu$ теперь функции от $w$, $\ell=\ell(w)$ и $\mu=\mu(w)$.

\begin{propose}
$$
\max_{x(\cdot)}\intd{t_0}{t} f(x(s))ds =\intd{t_0}{t}\max_{x(s)} f(x(s)) ds 
$$
\end{propose}

Пусть 
$$
x^*(\cdot) = \arg\max_{x(\cdot)} \intd{t_0}{t} f(x(s))ds
$$
$$
x^\circ(\cdot):  \intd{t_0}{t}f(x^\circ(s))=\intd{t_0}{t}\max_{x(s)} f(x(s)) ds.
$$
Предположим, что $x^*(\cdot)\neq x^\circ(\cdot)$ и $\intd{t_0}{t} f(x^*(s))ds \neq \intd{t_0}{t}f(x^\circ(s)) ds$.\\
Тогда для выражения $m(s)=f(x^*(s))-f(x^\circ(s))$ можно указать непересекающиеся отрезки $T_<,T_>,T_=$, на которых выполняются неравенства
$$
\forall s\in T_<:\, m(s) < 0,\; \forall s\in T_>:\, m(s)>0,\; \forall s\in T_=:\, m(s)=0.
$$
Для $T_>$ получаем, что
$$
\forall s\in T_> : f(x^*(s))>f(x^\circ(s))=\max_{x(s)}f(x(s)
$$ -- противоречие.\\
Для $T_<$ получаем, что 
$$
\max_{x(\cdot)}\intd{T_<}{}f(x(s))ds=\intd{T_<}{}f(x^*(s))ds < \intd{T_<}{}f(x^\circ(s))ds 
$$ -- противоречие.\\
Остается единственный вариант, который и доказывает утверждение.
{\centering $\blacksquare$}



Можно заметить, что от $w$ зависят только переменные $\tilde{S},\tilde{S}_1$ и пределы интегрирования. Поменяем порядок интегрирования, чтобы собрать вместе члены, зависящие от $w$. Применяя правила замены
$$
\intd{t_0}{t} d\phi(w) \intd{t}{w} ds(\cdot) =\intd{t}{t_0} ds \intd{t_0}{s} d\phi(w) (\cdot),
$$
$$
\intd{t_0}{t} d\phi(w) \intd{w}{t_0} ds(\cdot) =\intd{t}{t_0} ds \intd{s}{t} d\phi(w) (\cdot),
$$
и делая замену переменных
$$
\begin{aligned}
S(t_0,t_1)&=\intd{t_0}{t_1}\tilde{S}(w,t_1)\,d\phi(w)=\intd{t_0}{t_1}\left\{  G^T_2(w,t)G^T_1(t_0,w)\ell(w) + \mu(w) G_2^T(w,t)c \right\}\,d\phi(w), \\
S_1(t_0,t_1)&=\intd{t_0}{t_1}\tilde{S}_1(t_0,w)\,d\phi(w),=\intd{t_0}{t_1}\left\{ G^T_1(t_0,w)  \ell(w) \right\}\,d\phi(w),\\
K(\ell,\mu,\mathcal{X}_0)&=\intd{t_0}{t} \left[\frac{\mu(w)^2}{4} + \rho(\ell(w)\mid\mathcal{X}_0) + \frac{\|\ell(w)\|^2}{4} \right]\,d\phi(w)
\end{aligned}
$$
придем к 
\begin{equation}
\label{eq:value_w}
\begin{gathered}
 V(t,x)=\min_{u_1,u_2}\max_{v_1,v_2}\min_{\phi(w)} \max_{\ell(w)}\max_{\mu(w)} \bigg\{  \\
  S^T(t_0,t)x + \intd{t}{t_0} S^T(t_0,s)\left[B_2(s)u_2(s)+C_2(s)v_2(s)\right]\,ds+  \\
 + \intd{t}{t_0} S^T_1(s,t)\left[B_1(s)u_1(s)+C_1(s)v_1(s)\right]\,ds - \\
 - K(\ell,\mu,\mathcal{X}_0)  \bigg\},
\end{gathered}
\end{equation}
где $K(\ell,\mu,\mathcal{X}_0)$ -- выпуклая функция.

Будем искать опорную функцию к множеству достижимости $\mathcal{X}[t,\mathcal{X}_0]$, определяемому по найденному выше выражению \eqref{eq:value_w} для $V(t,x)$. 
Пользуясь линейностью по $\phi$, теперь можно переставить
$$
\max_{v_1,v_2}\min_{\phi} \max_{\ell}\max_{\mu} (\cdot)=\min_{\phi} \max_{\ell}\max_{\mu}\max_{v_1,v_2}(\cdot),
$$
и
$$
\max_{v(\cdot)}\intd{t}{t_0}f(v(s))ds=\max_{v(\cdot)}\intd{t_0}{t}-f(v(s))ds=\intd{t_0}{t}\max_{v(s)}[-f(v(s))]ds
$$
тогда
$$
\begin{gathered}
 V(t,x)=\min_{u_1,u_2}\min_{\phi} \max_{\ell}\max_{\mu} \bigg\{  \\
  S^T(t_0,t)x + \intd{t}{t_0} S^T(t_0,s)B_2(s)u_2(s)\,ds + \intd{t_0}{t}\rho(-S^T(t_0,s)\mid C_2(s)\mathcal{W}_2(s)) \,ds \\
 + \intd{t}{t_0} S^T_1(s,t)B_1(s)u_1(s)+ \intd{t_0}{t}\rho(-S^T_1(s,t)\mid C_1(s)\mathcal{W}_1)\,ds - \\
 - K(\ell,\mu,\mathcal{X}_0)  \bigg\}.
\end{gathered}
$$
Далее, мы хотим поменять $\min_{u_1,u_2}(\cdot)$ на опорную функцию, но полученное выше выражение уже не является вогнутым по $\ell,\mu$. Поэтому, мы прибегаем к овыпуклению нужных членов и приходим к 


$$
\begin{gathered}
\label{eq:V-fin}
 V(t,x)=\min_{\phi} \max_{\ell}\max_{\mu} \bigg\{  \\
  S^T(t_0,t)x - \intd{t_0}{t} \rho(S_1(s,t)\mid B_1(s)\mathcal{P}_1(s))\,ds - \intd{t_0}{t} \rho(S(t_0,s)\mid B_2(s)\mathcal{P}_2(s))\,ds - \\ - \mbox{conv}\left\{ -\intd{t_0}{t}\rho(-S_1(s,t)\mid C_1(s)\mathcal{W}_1(s))\,ds-\intd{t_0}{t}\rho(-S(t_0,s)\mid C_2(s)\mathcal{W}_2(s)) \,ds + K(\ell,\mu,\mathcal{X}_0)  \right\} \bigg\}.
\end{gathered}
$$

\begin{propose}
$$
\conv_{x(\cdot)}\intd{t_0}{t} f(x(t))dt =\intd{t_0}{t}\conv_{x(t)} f(x(t)) dt 
$$
\end{propose}
Примем 
$$
\conv(f)=f^{**}
$$
Тогда 
$$
\left(\intd{t_0}{t} f(x(s))ds\right)^*(\ell(t))=\max_{x(\cdot)}\left( \ts{\ell,x}_{L_2}-\intd{t_0}{t}f(x(s))ds\right)
$$
$$
\left(\intd{t_0}{t} f(x(t))dt\right)^{**}(y(t))=\max_{\ell(\cdot)}\left(\ts{y,\ell}_{L_2}-\max_{x(\cdot)}\left( \ts{\ell,x}_{L_2}-\intd{t_0}{t}f(x(s))ds\right)\right)=
$$
$$
=\max_{\ell(\cdot)}\min_{x(\cdot)}\left(\ts{y,\ell}_{L_2}- \ts{\ell,x}_{L_2}+\intd{t_0}{t}f(x(s))ds\right)=
$$
$$
=\max_{\ell(\cdot)}\min_{x(\cdot)}\intd{t_0}{t}\left[\ts{y(s),\ell(s)}- \ts{\ell(s),x(s)}+f(x(s))\right]ds=
$$
$$
=\intd{t_0}{t}\max_{\ell(s)}\min_{x(s)}\left[\ts{y(s),\ell(s)}- \ts{\ell(s),x(s)}+f(x(s))\right]ds=
$$
$$
=\intd{t_0}{t}\max_{\ell(s)}\left[\ts{y(s),\ell(s)}-\max_{x(s)}\left\{\ts{\ell(s),x(s)}-f(x(s))\right\} \right]ds=
$$
$$
=\intd{t_0}{t}f^{**}(s)ds
$$
{\centering $\blacksquare$}
\input{sopr}

